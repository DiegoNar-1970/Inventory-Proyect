<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My EJS App</title>
  <style>

        html{
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            background-color: rgb(78, 77, 77);
        }
        .green{
            color: green;
        }
        .orange{
            color: orange;
        }
        .section{
            display: flex;
            flex-direction: column;
            width: 250px;
            
        }
        .article-body{
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .article-footer{
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .body{
           width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .sec{
            display: none;
            width: 250px;
        }
        .article-button{
            width: 100%;
        }
        .div{
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        p{
            margin: 0;
            padding: 0;
        }
        .err,.err-password,.username-err {
            display: none;
        }
  </style>
</head>
<body class="body">
    <section class="sec">
        <article>
            <span class="green">Fruty</span><span class="orange">Green</span>
        </article>
        <article class="article-body">
            <div class="div">
                <label for="name-create" >Nombre</label>
                <input type="text" placeholder="Nombre" class="name-create">
            </div>
            <div class="div">
                <label for="userName-create" >Nombre de usuario</label>
                <input type="text" placeholder="Nombre" class="username-Create">
                <p class="username-err"></p>
            </div>
            <div class="div">
                <label for="password-create">Contrase単a</label>
                <input type="password" placeholder="******"  class="password-create">
            </div>
            <div class="div">
                <label for="confirmPassword">confirmar Contrase単a</label>
                <input type="password" placeholder="******" class="confirmPassword">
                <p class="password-err"></p> 
            </div> 
        </article>
        <article class="article-footer">
            <button class="article-button"> Crear Cuenta</button>
        </article>
        
    </section>
    <section class="section">
        <article>
            <span class="green">Fruty</span><span class="orange">Green</span>
        </article>
        <article class="article-body">
            <label for="userName" >Usuario</label>
            <input type="text" placeholder="Usuario" class="username">
            <label for="password">Contrase単a</label>
            <input type="password" placeholder="******" name="" class="password">      
        </article>
        <article class="article-footer">
            <button class="register">Registrarse</button>
            <button class="login">login</button>
        </article>
    </section>

  <script>
    const login = document.querySelector('.login')
    const register = document.querySelector('.register')
    const userName=document.querySelector('.username')
    const password=document.querySelector('.password')
    const section=document.querySelector('.section')
    const sec=document.querySelector('.sec')
    const btnCreateCount=document.querySelector('.article-button')


    const nameCreate=document.querySelector('.name-create');
    const userNameCreate=document.querySelector('.username-Create');
    const passwordCreate=document.querySelector('.password-create');
    const confirmPassword=document.querySelector('.confirmPassword');
    const usernameErr=document.querySelector('.username-err');
    const passwordErr=document.querySelector('.password-err');

        register.onclick=()=>{
            sec.style='display:block;'
            section.style='display:none'
        }

        btnCreateCount.onclick=()=>{
            if(confirmPassword.value!=passwordCreate.value){
                passwordErr.style='color:red;'
                passwordErr.innerHTML='las contrase単a no coincide'
                return
            }
            const data={
                name:nameCreate.value,
                userName:userNameCreate.value,
                password:passwordCreate.value
            }
            const options={
                method:'POST',
                headers:{
                    'Content-Type': 'application/json',
                },
                body:JSON.stringify(data)
            }

            fetch('http://localhost:3000/register',options)
            .then((res)=>res.json())
            .then((data)=>{
                if(data.message?.includes('E11000')){
                    usernameErr.style='display:block;';
                    usernameErr.innerHTML='el usuario ya existe';
                    usernameErr.style='color:red;';
                    throw new Error('usuario existente');
                }
                alert(`Se creo correctamente el usuario ${userNameCreate.value} presiona aceptar para continuar`)
                sec.style='display:none;'
                section.style='display:block'
            })
            .catch((err)=>{
                throw new Error(err.message)
            })
        }

        login.onclick=()=>{
            const data={
                userName:userName.value,
                password:password.value
            }
            const options={
                method:'POST',
                headers:{
                    'Content-Type': 'application/json',
                },
                body:JSON.stringify(data)
            }

            fetch('http://localhost:3000/login',options)
            .then((res)=>res.json())
            .then((data)=>{
                console.log(data);
            })
    }
  </script>
</body>
</html>